<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" >
    <title>Camera App Research - Argon test</title>
    <link href="app.css" rel="stylesheet" type="text/css" charset="utf-8" >
    <script src="vendor/three.js"></script>
    <script src="vendor/stats.js"></script>
    <script src="vendor/screenshot.js"></script>
    <script src="vendor/RecordRTC.js"></script>
    <script src="vendor/argon.js"></script>

    <script src="app-argon.js"></script>
</head>
<body>
<div id="argon">
    <button onclick="sharediv();">Share div</button><textarea>asdfasfsfd</textarea>
    <button onclick="stopsharediv();">Stop Sharing div</button>
    <video src="Big_Buck_Bunny_small.ogv" controls></video>
    <p id="info">
        Anything you put in this div (or in divs nested inside this one) will be rendered on the screen in 2D,
        in front of the 3D AR content in the Argon view.
    </p>

</div>
<script>
    var isRecordingStarted = false;
    var isStoppedRecording = false;
    var elementToShare = document.querySelector('#argon');
    var canvas2d = document.createElement('canvas');
    var context = canvas2d.getContext('2d');
    canvas2d.width = elementToShare.clientWidth;
    canvas2d.height = elementToShare.clientHeight;

    var recorder = new RecordRTC(canvas2d, {
        type: 'canvas'
    });
    function stopsharediv() {
        isStoppedRecording = true;
        recorder.stopRecording(function() {
            var blob = recorder.getBlob();
            var video = document.createElement('video');
            video.src = URL.createObjectURL(blob);
            video.setAttribute('style', 'height: 100%; position: absolute; top:0; right: 0;');
            elementToShare.appendChild(video);
            video.controls = true;
            video.play();
        });
    }
    function sharediv() {

        (function looper() {
            if(!isRecordingStarted) {
                return setTimeout(looper, 500);
            }
            html2canvas(elementToShare, {
                grabMouse: true,
                onrendered: function(canvas) {
                    context.clearRect(0, 0, canvas2d.width, canvas2d.height);
                    context.drawImage(canvas, 0, 0, canvas2d.width, canvas2d.height);
                    if(isStoppedRecording) {
                        return;
                    }
                    setTimeout(looper, 1);
                }
            });
        })();

        isRecordingStarted = true;

        recorder.startRecording();

    }
</script>
</body>
</html>
